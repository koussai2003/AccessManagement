<div class="application-manager container mt-5 fade-in">
  <h2>Manage Applications</h2>

  <!-- Add Application Form -->
  <div class="card p-3">
    <h4>Add New Application</h4>
    <div class="row g-3">
      <div class="col-md-4">
        <input type="text" class="form-control" placeholder="Application Name" [(ngModel)]="newApplication.name">
      </div>
      <div class="col-md-4">
        <input type="file" class="form-control" (change)="onFileSelected($event)">
      </div>
      <div class="col-md-4">
        <button class="btn btn-success w-100" (click)="addApplication()">Add</button>
      </div>
    </div>
  </div>
  <div class="card p-3 mt-4" *ngIf="editingApplication">
    <h4>Edit Application</h4>
    <div class="row">
      <div class="col-md-4">
        <input type="text" class="form-control" [(ngModel)]="editingApplication.name">
      </div>
      <div class="col-md-4">
        <input type="file" class="form-control" (change)="onEditFileSelected($event)">
      </div>
      <div class="col-md-4">
        <button class="btn btn-success" (click)="updateApplication()">Save</button>
        <button class="btn btn-secondary ms-2" (click)="editingApplication = null">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Applications Table -->
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Logo</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let app of applications">
          <td>{{ app.id }}</td>
          <td>{{ app.name }}</td>
          <td>
            <img [src]="getImageUrl(app.logoUrl)" alt="{{ app.name }}" class="app-logo">
          </td>
          <td><div class="button-container">
            <button class="btn btn-warning" (click)="editApplication(app); $event.stopPropagation();">Edit</button>
            <button class="btn btn-danger" (click)="deleteApplication(app.id)">Delete</button>
            <button class="btn btn-secondary" (click)="openModulesModal(app)">Modules</button>
          </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="custom-modal-backdrop" *ngIf="showModuleModal" (click)="closeModuleModal()">
    <div class="custom-modal" (click)="$event.stopPropagation()">
      <h5>Manage Modules for "{{ selectedAppForModules?.name }}"</h5>
      <div *ngFor="let module of modules; let mIdx = index" class="mb-4 border p-3 rounded bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <input class="form-control w-75" [(ngModel)]="module.name" placeholder="Module name" />
          <button class="btn btn-danger ms-2" (click)="deleteModule(mIdx)">Delete Module</button>
        </div>
      
        <div class="mt-3">
          <table class="table table-bordered text-center">
            <tbody>
              <tr *ngFor="let func of module.functions; let fIdx = index">
                <td><textarea class="form-control" rows="1" [(ngModel)]="func.name"></textarea></td>
                <td><button class="btn btn-sm btn-danger" (click)="deleteFunction(mIdx, fIdx)">Delete</button></td>
              </tr>
            </tbody>
          </table>
          <button class="btn btn-primary" (click)="addFunction(mIdx)">+ Add Function</button>
        </div>
      </div>
      
      <button class="btn btn-success mt-3" (click)="addModule()">+ Add Module</button>
      
  
      <div class="text-end mt-3">
        <button class="btn btn-secondary me-2" (click)="closeModuleModal()">Close</button>
        <button class="btn btn-success" (click)="saveModules()">Save Changes</button>
      </div>
    </div>
  </div>
</div>
